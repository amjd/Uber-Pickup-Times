<!doctype html>
<html>
  <head>
    <title></title>
    <meta charset="utf-8" />
    <link href="/static/style.css" rel="stylesheet">
    <link href="/static/bootstrap.min.css" rel="stylesheet">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Lato:400,300' rel='stylesheet' type='text/css'>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
    <script type="text/javascript" src="/static/gmaps.js"></script>
    <script type="text/javascript">
      var map;
      function getLocation()
        {
          var myNode = document.getElementById("info");
          while (myNode.firstChild) {
              myNode.removeChild(myNode.firstChild);
          }
          GMaps.geolocate({     
            success: function(position){
              latitude = position.coords.latitude;
              longitude = position.coords.longitude;
              map.setCenter(latitude, longitude);
              map.setZoom(16);
              map.addMarker({
                lat: latitude,
                lng: longitude,
                title: latitude + ', ' + longitude,
                infoWindow: {
                  content: '<p>You are here.</p>'
                }
              });
              $.get('http://{{ domain }}/livedata/'+latitude+'/'+longitude,function(data){
                data = JSON.parse(data);
                car_list = data['times'];
                if (car_list.length > 0)
                {
                  $('#info').append('<h3>Available cars</h3>');
                  for (var i=0; car_list.length; i++)
                  {
                    $('#info').append('<p>' + car_list[i]['display_name'] + ' / Estimated time: ' + (Math.round((car_list[i]['estimate']/60)*10)/10) + ' minutes.');
                    $('html, body').animate({scrollTop: $("#info").offset().top}, 2000)
                  }
                }
                else {
                  $('#info').append('<p>Sorry, no cars available at present.</p>');
                  $('html, body').animate({scrollTop: $("#info").offset().top}, 2000)
                }
              })
            },     
            error: function(error){    
              alert('Geolocation failed: ' + error.message);   
            },     
            not_supported: function(){    
              alert("Your browser does not support geolocation");     
            },     
            always: function(){    
            }    
          });
        }

        function refreshCars()
        {
          var myNode = document.getElementById("info");
          while (myNode.firstChild) {
              myNode.removeChild(myNode.firstChild);
          }
          $.get('http://{{ domain }}/livedata/'+latitude+'/'+longitude,function(data){
            data = JSON.parse(data);
            car_list = data['times'];
            if (car_list.length > 0)
            {
              $('#info').append('<h3>Available cars</h3>');
              for (var i=0; car_list.length; i++)
              {
                $('#info').append('<p>' + car_list[i]['display_name'] + ' / Estimated time: ' + (Math.round((car_list[i]['estimate']/60)*10)/10) + ' minutes.');
                $('html, body').animate({scrollTop: $("#info").offset().top}, 2000);
              }
            }
            else {
              $('#info').append('<p>Sorry, no cars available at present.</p>')
              $('html, body').animate({scrollTop: $("#info").offset().top}, 2000)
            }
          })
        }
      $(document).ready(function(){
        map = new GMaps({
          div: '#map',
          lat: 12.946550,
          lng: 77.600615,
          zoom: 10,
          scrollwheel: false
        });
        var styles = [{"featureType":"landscape","stylers":[{"hue":"#FFBB00"},{"saturation":43.400000000000006},{"lightness":37.599999999999994},{"gamma":1}]},{"featureType":"road.highway","stylers":[{"hue":"#FFC200"},{"saturation":-61.8},{"lightness":45.599999999999994},{"gamma":1}]},{"featureType":"road.arterial","stylers":[{"hue":"#FF0300"},{"saturation":-100},{"lightness":51.19999999999999},{"gamma":1}]},{"featureType":"road.local","stylers":[{"hue":"#FF0300"},{"saturation":-100},{"lightness":52},{"gamma":1}]},{"featureType":"water","stylers":[{"hue":"#0078FF"},{"saturation":-13.200000000000003},{"lightness":2.4000000000000057},{"gamma":1}]},{"featureType":"poi","stylers":[{"hue":"#00FF6A"},{"saturation":-1.0989010989011234},{"lightness":11.200000000000017},{"gamma":1}]}];

        map.addStyle({
          styledMapName:"Styled Map",
          styles: styles,
          mapTypeId: "light-dream"
        });
        map.setStyle("light-dream");

      });
    </script>
</head>
<body>
<div class="container">
  <div class="row">
    <div class="col-md-12">
      <h1 class="page-header">Uber Pickup Times</h1>
      <div id="map"></div>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12">
      <div class="button-gp">
        <button onclick="getLocation()" class="btns btn-lg"><i class="fa fa-location-arrow"></i> Find Cars</button>
        <button onclick="refreshCars()" class="btns btn-lg"><i class="fa fa-refresh"></i> Refresh List</button>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12">
      <div id="info">
      </div>
    </div>
  </div>
</div>
</body>
</html>
